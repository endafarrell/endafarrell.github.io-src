<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Colloquy demystifying JIRA references</title>
        <link rel="stylesheet" href="./theme/css/main.css" />
        <link href="http://endafarrell.net/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="endafarrell.net Atom Feed" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="./">endafarrell.net </a></h1>
                <nav><ul>
                    <li><a href="./category/geo.html">Geo</a></li>
                    <li><a href="./category/javascript.html">Javascript</a></li>
                    <li class="active"><a href="./category/other-code.html">Other code</a></li>
                    <li><a href="./category/python.html">Python</a></li>
                    <li><a href="./category/quantified-self.html">Quantified self</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="./colloquy-demystifying-jira-references.html" rel="bookmark"
           title="Permalink to Colloquy demystifying JIRA references">Colloquy demystifying JIRA references</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2009-08-03T20:20:00+02:00">
                Published: Mon 03 August 2009
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="./author/enda-farrell.html">Enda Farrell</a>
        </address>
<p>In <a href="./category/other-code.html">Other code</a>.</p>
<p>tags: <a href="./tag/perl.html">Perl</a> <a href="./tag/bbc-forge.html">bbc-forge</a> <a href="./tag/mac.html">mac</a> <a href="./tag/unix.html">unix</a> <a href="./tag/work.html">work</a> <a href="./tag/applescript.html">applescript</a> <a href="./tag/jira.html">jira</a> <a href="./tag/colloquy.html">Colloquy</a> </p>
</footer><!-- /.post-info -->      <p>The BBC’s Forge engineering team uses an IRC channel to hold meetings. It allows our team to not bother about exactly 
where everyone is - some folks work from home, people are (mostly) in the office, but can be in different parts of 
our buildings for all sorts of good reasons. So, we have JIRA instead of Agile “task cards” and we use IRC meetings 
instead of “standups”.</p>
<p>Link in any team, you’ll have some folks working on one aspect of the development, others on others. There’s an 
“idealisation” in many Agile software disciplines that suggests any developer can work on any task, yet this isn’t 
always so. Moreover, once someone is working on an aspect, the rest of the team are probably not going to stay on 
top of all of the JIRA references - yet in IRC we often just list those JIRA numbers to speed ourselves along.</p>
<p>It’s not at all difficult to link to these references but it takes quite a bit of discipline - and in fairness, I’d 
sooner be concentrating on what folks are saying rather than playing with URLs - hence a new plugin script for 
Colloquy that helps.</p>
<p>This script works with a small shell script that handles regex (there is an AppleScript plugin that can do this, but 
it’s not really needed for this) to identify a likely JIRA reference and to print out the title of the JIRA ticket.</p>
<p>First that little shell script:</p>
<div class="highlight"><pre><span></span><span class="ch">#!/opt/local/bin/perl</span>
<span class="nv">$LINE</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$JIRAREF</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span> <span class="nv">$LINE</span> <span class="o">=~</span> <span class="sr">m/(\w+\-\d+)/</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nv">$JIRAREF</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">print</span> <span class="nv">$JIRAREF</span><span class="p">;</span>
</pre></div>


<p>As you can see it does very little - it finds strings like “FSRV-102”, or “KV-1” and prints it out, otherwise it 
outputs nothing. Quite simple.</p>
<p>Second the AppleScript Colloquy plugin script:</p>
<div class="highlight"><pre><span></span><span class="k">property</span> <span class="nv">scriptInitialPath</span> <span class="p">:</span> <span class="nv">null</span>
<span class="k">property</span> <span class="nv">loadedScriptName</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span>

<span class="k">using terms from</span> <span class="nb">application</span> <span class="s2">&quot;Colloquy&quot;</span>
<span class="k">on</span> <span class="nv">process</span> <span class="nv">incoming</span> <span class="nv">chat</span> <span class="nv">message</span> <span class="nv">msg</span> <span class="k">in</span> <span class="nv">msgChatRoom</span>

    <span class="k">set</span> <span class="nv">frontRoom</span> <span class="k">to</span> <span class="nv">description</span> <span class="k">of</span> <span class="na">active</span> <span class="nb">panel</span> <span class="k">of</span> <span class="nb">front</span> <span class="na">window</span>
    <span class="c">-- to convert a chat room&#39;s name to a chat room&#39;s description, here&#39;s what</span>
    <span class="c">-- I needed to do. Depending on how you connect, you may need to change</span>
    <span class="c">-- this a little. You&#39;ll know that you do need to change this if you keep</span>
    <span class="c">-- getting JIRA titles when your &quot;front room&quot; fills with unexpected JIRA</span>
    <span class="c">-- titles! (Then again, perhaps you&#39;d like to know what&#39;s being talked</span>
    <span class="c">-- about and don&#39;t mind too much ...)</span>
    <span class="k">set</span> <span class="nv">msgChatRoomName</span> <span class="k">to</span> <span class="s2">&quot;Chat Room #&quot;</span> <span class="o">&amp;</span> <span class="na">name</span> <span class="k">of</span> <span class="nv">msgChatRoom</span> <span class="o">&amp;</span> <span class="s2">&quot; (127.0.0.1)&quot;</span>

    <span class="c">-- check that the message we&#39;re processing is on our front panel</span>
    <span class="k">if</span> <span class="nv">msgChatRoomName</span> <span class="ow">is equal</span> <span class="k">to</span> <span class="nv">frontRoom</span> <span class="k">then</span>
        <span class="k">try</span>
            <span class="c">-- the message is a class - not the text, so we have to extract it</span>
            <span class="k">set</span> <span class="nv">thisMessage</span> <span class="k">to</span> <span class="nv">HTML</span> <span class="k">of</span> <span class="nv">msg</span>
            <span class="c">-- I have a shell script that does the pattern matching. There is</span>
            <span class="c">-- an extension to AppleScript that allows for this sort of work,</span>
            <span class="c">-- but the Forge community is good with a little Unix and probably</span>
            <span class="c">-- don&#39;t mind installing a script.</span>
            <span class="c">-- The quotes are necessary as sentences often have spaces ...</span>
            <span class="k">set</span> <span class="nv">jiraRef</span> <span class="k">to</span> <span class="nb">do shell script</span> <span class="s2">&quot;~/jiraRef.pl \&quot;&quot;</span> <span class="o">&amp;</span> <span class="nv">thisMessage</span> <span class="o">&amp;</span> <span class="s2">&quot;\&quot;&quot;</span>
            <span class="c">-- call our separate method to handle this</span>
            <span class="nv">getJira</span><span class="p">(</span><span class="nv">jiraRef</span><span class="p">)</span>
        <span class="nb">on</span> <span class="k">error</span>
            <span class="c">-- annoyingly, AppleScript often fails silently - and I&#39;ve not</span>
            <span class="c">-- actually seen this run.</span>
            <span class="k">tell</span> <span class="na">active</span> <span class="nb">panel</span> <span class="k">of</span> <span class="nb">front</span> <span class="na">window</span>
                <span class="nv">add</span> <span class="nb">event</span> <span class="nv">message</span> <span class="s2">&quot;error caught: &quot;</span> <span class="o">&amp;</span> <span class="nv">errorMessage</span>
            <span class="k">end</span> <span class="k">tell</span>
        <span class="k">end</span> <span class="k">try</span>
    <span class="k">end</span> <span class="k">if</span>
<span class="k">end</span> <span class="nv">process</span> <span class="nv">incoming</span> <span class="nv">chat</span> <span class="nv">message</span>

<span class="k">on</span> <span class="nv">process</span> <span class="nv">user</span> <span class="nv">command</span> <span class="nv">cmd</span> <span class="nv">with</span> <span class="nv">args</span> <span class="nb">for</span> <span class="nv">chatRoom</span>    
<span class="c">-- This may be useful as it allows me to check jira refs</span>
<span class="k">if</span> <span class="nv">cmd</span> <span class="ow">is equal</span> <span class="k">to</span> <span class="s2">&quot;jira&quot;</span> <span class="k">then</span>
    <span class="k">set</span> <span class="nv">jiraLine</span> <span class="k">to</span> <span class="nv">args</span>
    <span class="k">set</span> <span class="nv">jiraRef</span> <span class="k">to</span> <span class="nb">do shell script</span> <span class="s2">&quot;~/jiraRef.pl \&quot;&quot;</span> <span class="o">&amp;</span> <span class="nv">args</span> <span class="o">&amp;</span> <span class="s2">&quot;\&quot;&quot;</span>
    <span class="nv">getJira</span><span class="p">(</span><span class="nv">jiraRef</span><span class="p">)</span>
<span class="k">end</span> <span class="k">if</span>

<span class="k">end</span> <span class="nv">process</span> <span class="nv">user</span> <span class="nv">command</span>

<span class="c">-- I&#39;m sure that in the future I&#39;ll add extra parameters to this so</span>
<span class="c">-- that I can get things like when it was last updated, the status</span>
<span class="c">-- and who perhaps last commented. But for now it&#39;s simple.</span>
<span class="k">to</span> <span class="nv">getJira</span><span class="p">(</span><span class="nv">jiraRef</span><span class="p">)</span>
    <span class="k">if</span> <span class="nv">jiraRef</span> <span class="ow">is not</span> <span class="ow">equal to</span> <span class="s2">&quot;&quot;</span> <span class="k">then</span>
        <span class="c">-- this next ommand is long - I might write this into a seperate</span>
        <span class="c">-- script. But again, for now it works and allows me flexibility</span>
        <span class="k">set</span> <span class="nv">jiraTitle</span> <span class="k">to</span> <span class="nb">do shell script</span> <span class="err">\</span>
            <span class="s2">&quot;curl --cert --pass -k https://JIRA-SERVER/browse/&quot;</span> <span class="o">&amp;</span> <span class="nv">jiraRef</span> <span class="o">&amp;</span> <span class="s2">&quot; \</span>
<span class="s2">            | grep &#39;&lt;title&gt;&#39; | sed &#39;s/title/em/g&#39; | sed &#39;s/ - BBC JIRA//&#39;&quot;</span>
        <span class="k">tell</span> <span class="na">active</span> <span class="nb">panel</span> <span class="k">of</span> <span class="nb">front</span> <span class="na">window</span>
            <span class="c">--add event message jiraTitle with name &quot;jiraTitle&quot;</span>
            <span class="nv">add</span> <span class="nb">event</span> <span class="nv">message</span> <span class="s2">&quot;JIRA &quot;</span> <span class="o">&amp;</span> <span class="nv">jiraTitle</span>
            <span class="c">--add event message &quot;</span>
            <span class="o">&amp;</span> <span class="s2">&quot;\&quot;&gt;&quot;</span> <span class="o">&amp;</span> <span class="nv">jiraTitle</span> <span class="o">&amp;</span> <span class="s2">&quot;&quot;</span> <span class="nv">with</span> <span class="na">name</span> <span class="s2">&quot;jiraTitle&quot;</span>
        <span class="k">end</span> <span class="k">tell</span>
    <span class="k">end</span> <span class="k">if</span>
<span class="k">end</span> <span class="nv">getJira</span>

<span class="k">on</span> <span class="nv">load</span> <span class="k">from</span> <span class="nv">scriptPath</span>
    <span class="k">set</span> <span class="nv">scriptAlias</span> <span class="k">to</span> <span class="p">(</span><span class="nv">POSIX</span> <span class="nv">file</span> <span class="nv">scriptPath</span><span class="p">)</span> <span class="k">as</span> <span class="nv">alias</span>
    <span class="k">set</span> <span class="nv">loadedScriptName</span> <span class="k">to</span> <span class="p">(</span><span class="na">name</span> <span class="k">of</span> <span class="p">(</span><span class="nb">info for</span> <span class="nv">scriptAlias</span><span class="p">))</span>

    <span class="k">set</span> <span class="nv">msg</span> <span class="k">to</span> <span class="p">(</span><span class="nv">loadedScriptName</span> <span class="o">&amp;</span> <span class="s2">&quot; Loaded /jira&quot;</span><span class="p">)</span> <span class="k">as </span><span class="nc">string</span>
    <span class="k">set</span> <span class="nv">evt</span> <span class="k">to</span> <span class="p">(</span><span class="nv">loadedScriptName</span> <span class="o">&amp;</span> <span class="s2">&quot;loaded&quot;</span><span class="p">)</span> <span class="k">as </span><span class="nc">string</span>
    <span class="k">tell</span> <span class="na">active</span> <span class="nb">panel</span> <span class="k">of</span> <span class="nb">front</span> <span class="na">window</span>
        <span class="nv">add</span> <span class="nb">event</span> <span class="nv">message</span> <span class="nv">msg</span> <span class="nv">with</span> <span class="na">name</span> <span class="nv">evt</span>
    <span class="k">end</span> <span class="k">tell</span>
<span class="k">end</span> <span class="nv">load</span>

<span class="k">on</span> <span class="nv">unload</span>
    <span class="k">set</span> <span class="nv">msg</span> <span class="k">to</span> <span class="p">(</span><span class="nv">loadedScriptName</span> <span class="o">&amp;</span> <span class="s2">&quot; Unloaded&quot;</span><span class="p">)</span> <span class="k">as </span><span class="nc">string</span>
    <span class="k">set</span> <span class="nv">evt</span> <span class="k">to</span> <span class="p">(</span><span class="nv">loadedScriptName</span> <span class="o">&amp;</span> <span class="s2">&quot;unloaded&quot;</span><span class="p">)</span> <span class="k">as </span><span class="nc">string</span>
    <span class="k">tell</span> <span class="na">active</span> <span class="nb">panel</span> <span class="k">of</span> <span class="nb">front</span> <span class="na">window</span>
        <span class="nv">add</span> <span class="nb">event</span> <span class="nv">message</span> <span class="nv">msg</span> <span class="nv">with</span> <span class="na">name</span> <span class="nv">evt</span>
    <span class="k">end</span> <span class="k">tell</span>
    <span class="k">set</span> <span class="nv">loadedScriptName</span> <span class="k">to</span> <span class="s2">&quot;&quot;</span>
<span class="k">end</span> <span class="nv">unload</span>

<span class="k">end</span> <span class="k">using terms from</span>
</pre></div>


<p>So, this script - when placed in your <code>~/Library/Application Support/Colloquy/PlugIns</code> will look at incoming 
messages in your front window (in a hack-tastic way), get the first of the JIRA references (if any), looks at our 
JIRA-SERVER to find the title of these references. The code could do with quite a bit of tidy-up, but it works and for 
the speed at which our team’s messages comes in, it’s fast enough.</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://endafarrell.net/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>